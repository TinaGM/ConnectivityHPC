!Tina's Linux Notes

!To Log in 
ssh TinaGinaMoMeena@login.hpc.ncsu.edu
! You will be prompted for a password

!Navigating to the project
! go to the shared drive 
cd /share/tcsi/tgmozele/ConnectivityHPC

! Order of operations: log in, navigate to drive, git pull, activate conda, run jobs, deactivate conda, git add, git commit, git push

!Veiw your scrach drive
ls 
!Open Project
cd ConnectivityHPC
ls 
! veiw files

! Once we are in the project
! Pull down the newest update
git pull 

! Once we are done for the day 

git add -A 
!or 
git add filename.file
git commit -m "Today Tina solved the problem"
git push -u origin master

!Generall movement
!move files  
mv filename.file drive/location
!up one level 
mv filename .. 
! move where you are up one level
cd ..
! move back to the highest level (Warning this may be higher than you think and you may not be able to get back easily)
cd 
!interrupt fucntion 
ctrl+c 
! read a text based file (text file, r code, code)
vi textfile.R
! exit out if the HPC opened up R and I'm now actually in R
q()

!!!! To give permissions/access to a folder or file (i.e. if Zachary or Tina uploads something, giving permission to the other person to edit/write):
chmod -R a+rwX *

! I dont know if you will need this. But if you need to get a internet connection in order to download packages try 
module load proxy_vars

!!! Running R
! to run a script
R myscript.R
!!!! this one worked
module load R
R CMD BATCH filename.R
!! To run a line 
R -c "library(raster);print("hi");a=1+5;print(a)"
!!!not the seperation by semi colon. 

!!! From the HPC website 
!!! On batching runs
#!/bin/tcsh
#BSUB -n 1 ! nodes
#BSUB -W 120 ! time in minutes
#BSUB -J mycode ! c1 function all code
#BSUB -o stdout.%J ! where to write outputs
#BSUB -e stderr.%J ! wher eto write outputs 
-R "rusage[usage_type=#number]".
#BSUB -R "rusage[mem=16000]"

!!! When we allocate resources we alllllllways write down our job id so we don't los eit and then can't kill it and then we charge 1000000$ to robs account. 
bjobs -l JOBID
bkill JOBID
!!! if we forget we can kill all jobs  by using 
bkill 0  (zero)
!mycode.exe

!!! File path to conda env
/usr/local/usrapps/tcsi/env_tcsi

!Loading in HPC jobs 
conda activate /usr/local/usrapps/tcsi/env_tcsi
!then submit script 
bsub < PracticeRun.csh
!check on run 
bjobs
! when STAT is done or there are no jobs listed job is done. You can check on it 
bjobs -l JOB ID
!This will give you a big list of things, but should say if it is done, or that the cpue time used is ___ that means its still running

!Once you are done, 
!check the file
vi std.outJobID#
!This will give you the low down on how the run went  


! Setting up argument passing in an r file 
! See https://stackoverflow.com/questions/14167178/passing-command-line-arguments-to-r-cmd-batch
! At the begining of the R code include 



! run as 
R CMD BATCH  singletimestepHPC_firsthalf.R '--args i=20' 

! Setting up conda
! Any of the steps listed below that contain brackets [] are just for denote that this si where your project specific information goes. Don't actually include brackets.
! First, follow step 1 to initialize conday and set 2 to make a condarc file from this website: https://projects.ncsu.edu/hpc/Software/Apps.php?app=Conda
! DO NOT DO conda create --prefix /usr/local/usrapps/[your_path]/env_ABC AAA BBB CCC 

! Instead, make the YAML file:
nano [projectname- don't include brackets].yml

! And put this text in the YAML file:
name: tcsi
channels:
  - conda-forge
  - r
dependencies:
 - r-[package you want to use]
 - r-[another package you'll use]
 - r-[and another, etc.]

! Then  do
conda env create --prefix=/usr/local/usrapps/[your_path]/env_[projectname] -f [projectname].yml

! That will install all the packages.  It might take some time.  After it installs, do:
conda activate /usr/local/usrapps/[your_path]/env_[projectname]
! ('conda activate' is like 'module load' in that it sets the environment)

! To exit the environment, do:
conda deactivate
 
!
To run the script with multiple jobs 
!first give it permission by 
chmod u+x New_Job_Submit.csh
! Then run
./New_Job_Submit.csh
